<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ตรวจสอบประเภทโทรศัพท์</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 20px; background:#f7fafc; color:#0f172a; }
    .card { background: white; border-radius: 12px; box-shadow: 0 6px 18px rgba(2,6,23,0.08); padding: 18px; max-width: 800px; margin: 12px auto; }
    h1 { font-size: 20px; margin: 0 0 8px 0; }
    p.lead { margin: 0 0 16px 0; color: #475569; }
    button { background:#0369a1; color:white; border:0; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:600; }
    button.secondary { background:#e2e8f0; color:#0f172a; margin-left:8px; }
    pre { background:#0b1220; color:#e6eef8; padding:12px; border-radius:8px; overflow:auto; font-size:13px; }
    table { width:100%; border-collapse:collapse; margin-top:12px; }
    td{ padding:8px 6px; border-top:1px solid #eef2f7; vertical-align:top; }
    .key{ width:32%; color:#334155; font-weight:600; }
    .value{ color:#0f172a; word-break:break-word; }
    .small { font-size:13px; color:#64748b; margin-top:8px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>ตรวจสอบประเภทโทรศัพท์ (Device Detector)</h1>
    <p class="lead">
      กดปุ่มเพื่อดึงข้อมูลอุปกรณ์ของคุณ พร้อมบันทึกไปยัง Google Sheet อัตโนมัติ
    </p>

    <div>
      <button id="detectBtn">ตรวจสอบอุปกรณ์ตอนนี้</button>
      <button id="copyBtn" class="secondary">คัดลอกเป็นข้อความ</button>
    </div>

    <div id="result" style="margin-top:14px; display:none;">
      <table>
        <tr><td class="key">ประเภทอุปกรณ์</td><td class="value" id="deviceType"></td></tr>
        <tr><td class="key">ระบบปฏิบัติการ</td><td class="value" id="os"></td></tr>
        <tr><td class="key">ยี่ห้อ/รุ่น</td><td class="value" id="model"></td></tr>
        <tr><td class="key">User Agent</td><td class="value"><small id="ua"></small></td></tr>
        <tr><td class="key">Client Hints</td><td class="value"><small id="clientHints"></small></td></tr>
        <tr><td class="key">ขนาดหน้าจอ</td><td class="value" id="screen"></td></tr>
        <tr><td class="key">สัมผัส / Touch</td><td class="value" id="touch"></td></tr>
      </table>

      <div class="small">หมายเหตุ: เบราว์เซอร์บางตัวอาจซ่อนข้อมูลรุ่นโทรศัพท์</div>

      <pre id="rawJson" style="margin-top:12px; display:none;"></pre>
    </div>
  </div>

<script>
const GOOGLE_SHEET_API = "PUT_YOUR_GOOGLE_SCRIPT_URL_HERE";

// ----------- Device Detection ------------
async function detectDevice() {
  const out = {};

  out.userAgent = navigator.userAgent || "ไม่พบ userAgent";
  out.platform = navigator.platform || "ไม่ระบุ";
  out.screen = {
    width: window.screen.width,
    height: window.screen.height,
    innerWidth: window.innerWidth,
    innerHeight: window.innerHeight,
    devicePixelRatio: window.devicePixelRatio || 1
  };
  out.touchSupported = (('ontouchstart' in window) || navigator.maxTouchPoints > 0);

  out.hints = {};
  if (navigator.userAgentData && navigator.userAgentData.getHighEntropyValues) {
    try {
      const high = await navigator.userAgentData.getHighEntropyValues(
        ['platform','platformVersion','brands','model','mobile','uaFullVersion']
      );
      out.hints = high;
    } catch (e) {
      out.hintsError = e.toString();
    }
  } else {
    out.hints = null;
  }

  const ua = out.userAgent.toLowerCase();

  if (/mobile|iphone|ipod|android.*mobile|windows phone/.test(ua) || (out.hints && out.hints.mobile)) {
    out.deviceType = 'มือถือ (Mobile)';
  } else if (/tablet|ipad|android(?!.*mobile)/.test(ua)) {
    out.deviceType = 'แท็บเล็ต (Tablet)';
  } else {
    out.deviceType = 'เดสก์ท็อป / อื่นๆ';
  }

  let os = 'ไม่ทราบ';
  if (/android/i.test(ua)) os = 'Android';
  else if (/iphone|ipad|ipod/i.test(ua)) os = 'iOS / iPadOS';
  else if (/mac os/i.test(ua)) os = 'macOS';
  else if (/windows nt/i.test(ua)) os = 'Windows';
  else if (/linux/i.test(ua)) os = 'Linux';

  out.os = os;

  let model = out.hints?.model || null;

  if (!model) {
    const androidModel = out.userAgent.match(/\b(SM-[A-Z0-9]+|Pixel\s?[0-9A-Za-z\-]+|HUAWEI|HONOR|Mi[\s\-]?[0-9]+|Redmi|Vivo|OPPO|Poco|Realme)[\/\s\-]?[A-Za-z0-9]*\b/i);
    if (androidModel) model = androidModel[0];
  }

  if (!model) model = 'ไม่สามารถระบุรุ่นได้';

  let brands = null;
  if (navigator.userAgentData?.brands) {
    brands = navigator.userAgentData.brands.map(b => `${b.brand} v${b.version}`).join(' | ');
  }

  return {
    deviceType: out.deviceType,
    os: out.os,
    model,
    userAgent: out.userAgent,
    clientHints: out.hints,
    brands,
    screen: out.screen,
    touchSupported: out.touchSupported,
    raw: out
  };
}

// ----------- Send to Google Sheet ------------
async function sendToGoogleSheet(info) {
  if (!GOOGLE_SHEET_API.startsWith("https://script.google.com")) {
    console.warn("ยังไม่ได้ใส่ Google Script URL");
    return;
  }

  const payload = {
    DeviceType: info.deviceType,
    OS: info.os,
    Model: info.model,
    Screen: `${info.screen.width}×${info.screen.height} (inner ${info.screen.innerWidth}×${info.screen.innerHeight}) DPR ${info.screen.devicePixelRatio}`,
    Touch: info.touchSupported ? "รองรับการสัมผัส" : "ไม่รองรับสัมผัส",
    UserAgent: info.userAgent,
    ClientHints: JSON.stringify(info.clientHints)
  };

  try {
    await fetch(GOOGLE_SHEET_API, {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
  } catch (err) {
    console.error("ส่งข้อมูลผิดพลาด:", err);
  }
}

// ----------- UI Events ------------
const detectBtn = document.getElementById('detectBtn');
const copyBtn = document.getElementById('copyBtn');

detectBtn.addEventListener('click', async () => {
  detectBtn.disabled = true;
  detectBtn.textContent = 'กำลังตรวจสอบ...';

  const info = await detectDevice();

  document.getElementById('deviceType').textContent = info.deviceType;
  document.getElementById('os').textContent = info.os;
  document.getElementById('model').textContent = info.model;
  document.getElementById('ua').textContent = info.userAgent;

  document.getElementById('clientHints').textContent = 
    info.brands || JSON.stringify(info.clientHints || {});

  document.getElementById('screen').textContent = 
    `${info.screen.width}×${info.screen.height} (inner ${info.screen.innerWidth}×${info.screen.innerHeight}) DPR ${info.screen.devicePixelRatio}`;

  document.getElementById('touch').textContent = 
    info.touchSupported ? 'รองรับการสัมผัส' : 'ไม่รองรับสัมผัส';

  document.getElementById('rawJson').style.display = 'block';
  document.getElementById('rawJson').textContent = JSON.stringify(info, null, 2);

  document.getElementById('result').style.display = 'block';

  sendToGoogleSheet(info);

  detectBtn.disabled = false;
  detectBtn.textContent = 'ตรวจสอบอุปกรณ์ตอนนี้';
});

copyBtn.addEventListener('click', () => {
  if (document.getElementById('result').style.display === 'none') 
    return alert("ยังไม่มีผลลัพธ์");

  const txt =
    `ประเภทอุปกรณ์: ${document.getElementById('deviceType').textContent}\n` +
    `ระบบปฏิบัติการ: ${document.getElementById('os').textContent}\n` +
    `รุ่น: ${document.getElementById('model').textContent}\n` +
    `ขนาดหน้าจอ: ${document.getElementById('screen').textContent}\n` +
    `User Agent: ${document.getElementById('ua').textContent}`;

  navigator.clipboard.writeText(txt);
  copyBtn.textContent = "คัดลอกแล้ว ✓";
  setTimeout(()=> copyBtn.textContent = "คัดลอกเป็นข้อความ", 1500);
});
</script>
</body>
</html>
