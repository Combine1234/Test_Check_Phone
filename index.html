<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 20px; background:#f7fafc; color:#0f172a; }
    .card { background: white; border-radius: 12px; box-shadow: 0 6px 18px rgba(2,6,23,0.08); padding: 18px; max-width: 800px; margin: 12px auto; }
    h1 { font-size: 20px; margin: 0 0 8px 0; }
    p.lead { margin: 0 0 16px 0; color: #475569; }
    button { background:#0369a1; color:white; border:0; padding:10px 14px; border-radius:8px; cursor:pointer; font-weight:600; }
    button.secondary { background:#e2e8f0; color:#0f172a; margin-left:8px; }
    pre { background:#0b1220; color:#e6eef8; padding:12px; border-radius:8px; overflow:auto; font-size:13px; }
    table { width:100%; border-collapse:collapse; margin-top:12px; }
    td{ padding:8px 6px; border-top:1px solid #eef2f7; vertical-align:top; }
    .key{ width:32%; color:#334155; font-weight:600; }
    .value{ color:#0f172a; word-break:break-word; }
    .small { font-size:13px; color:#64748b; margin-top:8px; }
  </style>
</head>
<body>
  <div class="card">
    <h1>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (Device Detector)</h1>
    <p class="lead">
      ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheet ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    </p>

    <div>
      <button id="detectBtn">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
      <button id="copyBtn" class="secondary">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
    </div>

    <div id="result" style="margin-top:14px; display:none;">
      <table>
        <tr><td class="key">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</td><td class="value" id="deviceType"></td></tr>
        <tr><td class="key">‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£</td><td class="value" id="os"></td></tr>
        <tr><td class="key">‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠/‡∏£‡∏∏‡πà‡∏ô</td><td class="value" id="model"></td></tr>
        <tr><td class="key">User Agent</td><td class="value"><small id="ua"></small></td></tr>
        <tr><td class="key">Client Hints</td><td class="value"><small id="clientHints"></small></td></tr>
        <tr><td class="key">‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠</td><td class="value" id="screen"></td></tr>
        <tr><td class="key">‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™ / Touch</td><td class="value" id="touch"></td></tr>
      </table>

      <div class="small">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ö‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏≤‡∏à‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∏‡πà‡∏ô‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</div>

      <pre id="rawJson" style="margin-top:12px; display:none;"></pre>
    </div>
  </div>

<script>
// üîª ‡πÉ‡∏™‡πà URL Google Script ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
const GOOGLE_SHEET_API = "https://script.google.com/macros/s/AKfycbwL_VjdFYHMkDlyzICH9UAqDNdibAZ-fP4fe7o_PrjTjxgYlEKGlszzmu8D3eV3xwgA7g/exec";

async function detectDevice() {
  const out = {};

  out.userAgent = navigator.userAgent || "‡πÑ‡∏°‡πà‡∏û‡∏ö userAgent";
  out.platform = navigator.platform || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏";
  out.screen = {
    width: window.screen.width,
    height: window.screen.height,
    innerWidth: window.innerWidth,
    innerHeight: window.innerHeight,
    devicePixelRatio: window.devicePixelRatio || 1
  };
  out.touchSupported = (('ontouchstart' in window) || navigator.maxTouchPoints > 0);

  out.hints = {};
  if (navigator.userAgentData && navigator.userAgentData.getHighEntropyValues) {
    try {
      const high = await navigator.userAgentData.getHighEntropyValues(
        ['platform','platformVersion','brands','model','mobile','uaFullVersion']
      );
      out.hints = high;
    } catch (e) {
      out.hintsError = e.toString();
    }
  } else {
    out.hints = null;
  }

  const ua = out.userAgent.toLowerCase();

  // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
  if (/mobile|iphone|ipod|android.*mobile|windows phone/.test(ua) || (out.hints && out.hints.mobile)) {
    out.deviceType = '‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ (Mobile)';
  } else if (/tablet|ipad|android(?!.*mobile)/.test(ua)) {
    out.deviceType = '‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏•‡πá‡∏ï (Tablet)';
  } else {
    out.deviceType = '‡πÄ‡∏î‡∏™‡∏Å‡πå‡∏ó‡πá‡∏≠‡∏õ / ‡∏≠‡∏∑‡πà‡∏ô‡πÜ';
  }

  // OS
  let os = '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö';
  if (/android/i.test(ua)) os = 'Android';
  else if (/iphone|ipad|ipod/i.test(ua)) os = 'iOS / iPadOS';
  else if (/mac os/i.test(ua)) os = 'macOS';
  else if (/windows nt/i.test(ua)) os = 'Windows';
  else if (/linux/i.test(ua)) os = 'Linux';

  out.os = os;

  // Model
  let model = out.hints?.model || null;

  if (!model) {
    const androidModel = out.userAgent.match(/\b(SM-[A-Z0-9]+|Pixel\s?[0-9A-Za-z\-]+|HUAWEI|HONOR|Mi[\s\-]?[0-9]+|Redmi|Vivo|OPPO|Poco|Realme)[\/\s\-]?[A-Za-z0-9]*\b/i);
    if (androidModel) model = androidModel[0];
  }

  if (!model) model = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏∏‡πà‡∏ô‡πÑ‡∏î‡πâ';

  let brands = null;
  if (navigator.userAgentData?.brands) {
    brands = navigator.userAgentData.brands.map(b => `${b.brand} v${b.version}`).join(' | ');
  }

  return {
    deviceType: out.deviceType,
    os: out.os,
    model,
    userAgent: out.userAgent,
    clientHints: out.hints,
    brands,
    screen: out.screen,
    touchSupported: out.touchSupported,
    raw: out
  };
}

// üîª ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏π‡πÄ‡∏Å‡∏¥‡∏•‡∏ä‡∏µ‡∏ï
async function sendToGoogleSheet(info) {
  if (!GOOGLE_SHEET_API.startsWith("https://script.google.com")) {
    console.warn("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà Google Script URL");
    return;
  }

  const payload = {
    Timestamp: new Date().toLocaleString("th-TH"),
    DeviceType: info.deviceType,
    OS: info.os,
    Model: info.model,
    Screen: `${info.screen.width}√ó${info.screen.height} (inner ${info.screen.innerWidth}√ó${info.screen.innerHeight}) DPR ${info.screen.devicePixelRatio}`,
    Touch: info.touchSupported ? "‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™" : "‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™",
    UserAgent: info.userAgent,
    ClientHints: JSON.stringify(info.clientHints)
  };

  try {
    await fetch(GOOGLE_SHEET_API, {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
  } catch (err) {
    console.error("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", err);
  }
}

// --------------- UI Events ---------------
const detectBtn = document.getElementById('detectBtn');
const copyBtn = document.getElementById('copyBtn');
const resultEl = document.getElementById('result');
const deviceTypeEl = document.getElementById('deviceType');
const osEl = document.getElementById('os');
const modelEl = document.getElementById('model');
const uaEl = document.getElementById('ua');
const clientHintsEl = document.getElementById('clientHints');
const screenEl = document.getElementById('screen');
const touchEl = document.getElementById('touch');
const rawJsonEl = document.getElementById('rawJson');

detectBtn.addEventListener('click', async () => {
  detectBtn.disabled = true;
  detectBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';

  try {
    const info = await detectDevice();

    deviceTypeEl.textContent = info.deviceType;
    osEl.textContent = info.os;
    modelEl.textContent = info.model;
    uaEl.textContent = info.userAgent;

    clientHintsEl.textContent = info.brands || JSON.stringify(info.clientHints || {});
    screenEl.textContent = `${info.screen.width}√ó${info.screen.height} (inner ${info.screen.innerWidth}√ó${info.screen.innerHeight}) DPR ${info.screen.devicePixelRatio}`;
    touchEl.textContent = info.touchSupported ? '‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™' : '‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™';

    rawJsonEl.style.display = 'block';
    rawJsonEl.textContent = JSON.stringify(info, null, 2);

    resultEl.style.display = 'block';

    // ‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ Google Sheet ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ
    sendToGoogleSheet(info);

  } finally {
    detectBtn.disabled = false;
    detectBtn.textContent = '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ';
  }
});

copyBtn.addEventListener('click', () => {
  if (resultEl.style.display === 'none') return alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå");

  const txt =
    `‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: ${deviceTypeEl.textContent}\n` +
    `‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£: ${osEl.textContent}\n` +
    `‡∏£‡∏∏‡πà‡∏ô: ${modelEl.textContent}\n` +
    `‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠: ${screenEl.textContent}\n` +
    `User Agent: ${uaEl.textContent}`;

  navigator.clipboard.writeText(txt);
  copyBtn.textContent = "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úì";
  setTimeout(()=> copyBtn.textContent = "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°", 1500);
});
</script>
</body>
</html>
